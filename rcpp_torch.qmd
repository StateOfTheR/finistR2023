---
title: "Rcpp & Torch"
format: html
toc: true
author: 
  - Annaig De-Walsche
  - Barbara Bricout
  - Tristan Mary-Huard
  - Armand Favrot
  - Félix Cheysson
  - Théodore Vanrenterghem
date: 20/08/2023
---

## Introduction

Nous allons d'abord intsller la librairie intel MKL, cette librairie d'algèbre linéaire permet de d'optimiser et/ou de paralléliser un certains nombre d'opérations algébrique, notamment le calcul matriciel.

```{r}
library(tictoc)
library(bench) # comparaison des vitesses 
```

Sans la librairie **Intel MKL**, un produit matriciel de 10000 x 10000 dure environ 5 min (Intel i7 - 8 coeurs)

```{r}
#| eval: false
size <- 10000
mat <- matrix(rnorm(size**2),size,size)

tic()
get_res <- mat %*% mat
toc()
```

Avant l'installation les librairies utilisées pour du calcul matriciel en R sont  `libblas.so.3.10.0` et `liblapack.so.3.10.0` (on peut les voir avec la ligne)

```{r}
#| eval: false
sessionInfo()
```



## Installation sur Windows

Le plus simple est de recycler les librairies de microsoft R Open (ex version de R distribuée par microsoft qui utilisait la librairie MKL par défaut). Une fois mixrosoft R open installé, il suffit d'aller récupérer dans le répertoire :

C:\Program Files\Microsoft\R Open\R-4.0.2\bin\x64

les trois fichiers nommés
1. Rblas.dll
1. Rlapack.dll
1. libiomp5md.dll

et de les copier dans le répertoire

C:\Program Files\R\R-4.1.2\bin\x64

Concrètement on remplace les deux fichiers faisant appel au librairies blas et lapack par des fichiers du même nom mais qui en pratique font implicitement appel à mkl.



## Installation sur Linux (Ubuntu 22.04)

```
sudo apt install intel-mkl
```
(Attention dans le terminal quand le message s'affiche appuyer sur la flèche droite puis finir l'instalation par défaut)

## Test de la librairie

Une fois instalée vérifié si les librairies sont bien référencées pour le calcul matriciel avec 

```{r}
#| eval: false
sessionInfo()
```


Après l'installation les librairies utilisées pour du calcul matriciel en R sont  `BLAS/LAPACK` (`/usr/lib/x86_64-linux-gnu/libmkl_rt.so`) et `LAPACK` version 3.10.0

```{r}
#| eval: false
tic()
get_res <- mat %*% mat
toc()
```

Suite à installation : le même calcul ne prend plus que 1 min. 
